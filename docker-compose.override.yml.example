version: "3"
services:
  app:
    command: ./docker-command.override
    volumes:
        - ./app:/home/pyuser/app:delegated
        - app_user:/home/pyuser # for bash history etc
    ports:
      - $APP_PORT:$APP_PORT  
  pg:
    restart: unless-stopped
    ports:
      - $POSTGRES_PORT:5432
    volumes:
      - ./.pg_data:/pgdata
  redis:
    command: /opt/bitnami/scripts/redis/run.sh --maxmemory 100mb
    volumes:
      - ./.redis_data:/bitnami/redis/data
    ports:
      - "$REDIS_PORT_NUMBER:$REDIS_PORT_NUMBER"
volumes:
  app_user:
  pg_data:
  redis_data: